openapi: 3.0.4
info:
  title: 用户&消息接口 - OpenAPI 3.0
  description: |-
    用户&消息接口

tags:
  - name: user
    description: Operations about user
  - name: message
    description: Operations about message
  - name: session
    description: Operations about session
components:
  schemas:
    User:
      type: object
      properties:
        user_id:
          type: string
          description: 用户公共ID
          example: user_public_id
        username:
          type: string
          example: theUser
        email:
          type: string
          example: john@email.com
        access_token:
          type: string
          example: '12345'
    Message:
        description: 聊天记录(包括用户输入和对应的ai返回)
        type: object
        properties:
          id:
            type: string
            description: 消息公共ID
            example: "msg_123456789"
          session_id:
            type: integer
            description: 恩语录ID
            example: 1
          context_id:
            type: string
            description: 上下文ID
            example: "ctx_abcdef123456"
          summary:
            type: string
            description: 消息摘要
            example: "关于信仰问题的讨论"
          status:
            type: integer
            description: 消息状态
            example: 2
            enum:
              - "0:初始化"
              - "1:处理中"
              - "2:成功"
              - "3:用户消息已删除"
              - "4:错误"
              - "5:超时"
              - "6:已取消"
          action:
            type: integer
            description: 消息动作类型
            example: 1
          content:
            type: string
            description: 消息内容
            example: "请问如何理解神的救赎？"
          reply:
            type: string
            description: 消息回复
            example: "神的救赎是..."
          feedback:
            $ref: '#/components/schemas/MessageFeedback'
          feedback_text:
            type: string
            description: 反馈文本
            example: "这个回答很有帮助"
          created_at:
            type: string
            format: date-time
            description: 创建时间
            example: "2023-10-01T12:00:00Z"
          created_ts:
            type: long
            format: long
            description: 创建时间戳(ms)
            example: "1768478418333"
          updated_ts:
            type: long
            format: long
            description: 最后更新时间戳(ms)
            example: "1768478418333"
    MessageFeedback:
        type: object
        properties:
          bible:
            type: string
            description: 相关圣经经文
            example: "你们要将一切的忧虑卸给神，因为他顾念你们。（彼前5:7）"
          explore:
            type: array
            description: 探索问题列表
            items:
              type: string
              example: "如何区分“交托重担”与“消极逃避责任”？"
            example:
              - "如何区分“交托重担”与“消极逃避责任”？"
              - "圣经中哪些人物的经历展现了“重担中的救赎”？"
              - "信徒面对长期重担时，如何持守对神救赎的信心？"
          summary:
            type: string
            description: 反馈摘要
            example: "重担中见救赎"
          topic:
            type: string
            description: 主题分类
            example: "信仰问答"
          view:
            type: string
            description: 详细观点内容
            example: "ai回复的正文内容"
    UserMessage:
      description: 用户笔记(恩语录)
      type: object
      properties:
        id:
          type: string
          description: 消息公共ID
          example: "msg_123456789"
        session_id:
          type: integer
          description: 恩语录ID
          example: 1
        context_id:
          type: string
          description: 上下文ID
          example: "ctx_abcdef123456"
        summary:
          type: string
          description: 消息摘要
          example: "关于信仰问题的讨论"
        status:
          type: integer
          description: 消息状态
          example: 2
          enum:
            - "0:初始化"
            - "1:处理中"
            - "2:成功"
            - "3:用户消息已删除"
            - "4:错误"
            - "5:超时"
            - "6:已取消"
        action:
          type: integer
          description: 消息动作类型
          example: 1
        content:
          type: string
          description: 消息内容
          example: "请问如何理解神的救赎？"
        reply:
          type: string
          description: 消息回复
          example: "神的救赎是..."
        feedback:
          $ref: '#/components/schemas/MainFeedback'
        feedback_text:
          type: string
          description: 反馈文本
          example: "这个回答很有帮助"
        created_at:
          type: string
          format: date-time
          description: 创建时间
          example: "2023-10-01T12:00:00Z"
        created_ts:
          type: long
          format: long
          description: 创建时间戳(ms)
          example: "1768478418333"
        updated_ts:
          type: long
          format: long
          description: 最后更新时间戳(ms)
          example: "1768478418333"
    MainFeedback:
      type: object
      properties:
        topic:
          type: string
          description: 主题分类
          example: "信仰问答"
    MessageId:
        type: object
        properties:
          id:
            type: string
            description: 消息公共uuid
            example: "msg_123456789"
    Session:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 会话ID（只读）
          example: 123
          readOnly: true
        session_name:
          type: string
          description: 会话名称
          example: "信仰问题讨论"
          minLength: 1
          maxLength: 100
        updated_at:
          type: string
          format: date-time
          description: 最后更新时间（只读）
          example: "2023-10-01T12:00:00Z"
          readOnly: true
    ApiResponse:
      type: object
      description: 返回的统一结构
      properties:
          success:
            type: boolean
            description: 请求是否成功
            example: true
          data:
            type: object
            description: 具体的业务数据